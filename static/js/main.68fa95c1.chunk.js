(this.webpackJsonpreactcharts=this.webpackJsonpreactcharts||[]).push([[0],{169:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(46),s=a.n(o),i=(a(53),a(15)),c=a(16),l=a(18),u=a(17),d=a(19),m=(a(54),a(30)),p=(a(150),a(151)),h=!0,g=function(e){function t(){return Object(i.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t={trackNames:[],subTrackData:{},subAudioFeatureData:{}};try{Object.keys(this.props.rawIncomingData).map((function(a){return t[a]=e.props.rawIncomingData[a]})),t.spotifyAudioFeatures.map((function(e){t.subAudioFeatureData[e]=[]})),t.rawDataByTrack.map((function(e){t.trackNames.push(e.trackName),t.subTrackData[e.trackName]=[],t.spotifyAudioFeatures.map((function(a){t.subAudioFeatureData[a].push(e.audioFeatures[a]),t.subTrackData[e.trackName].push(e.audioFeatures[a])}))})),t.dataByAudioFeature={datasets:[],labels:t.trackNames},t.dataByTrack={datasets:[],labels:t.spotifyAudioFeatures};var a=0;t.spotifyAudioFeatures.map((function(e){var n={label:e,data:t.subAudioFeatureData[e],fill:!1,borderColor:t.colors[a]};(a+=1)===t.colors.length&&(a=0),t.dataByAudioFeature.datasets.push(n)}));var n=0;t.rawDataByTrack.map((function(a){var r=e.props.colors[1],o=!1;n===e.props.selectedTrackIndex&&(r=e.props.colors[0],o=!0),n+=1;var s={label:a.trackName,data:t.subTrackData[a.trackName],fill:!0,borderColor:r,drawBorder:o};t.dataByTrack.datasets.push(s)})),h=!1}catch(o){console.log("still loading data"),h=!0}return h?r.a.createElement("div",{className:"loading"},r.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"}},r.a.createElement(p,{name:"ball-triangle-path",fadeIn:"none"})),r.a.createElement("div",null,r.a.createElement("h1",null,"Loading track data..."))):r.a.createElement("div",{className:"chart"},r.a.createElement("div",{className:"topRow"},r.a.createElement("div",{className:"buttons"},r.a.createElement("form",{onSubmit:function(t){return e.props.onRequestNewTracks(t)}},r.a.createElement("input",{type:"submit",value:"Swap adjusted tracks with new recommendations"})),r.a.createElement("form",{onSubmit:function(t){return e.props.onCommitSet(t)}},r.a.createElement("input",{type:"submit",value:"Upload this playlist to Spotify"}))),r.a.createElement("div",{className:"radar"},r.a.createElement(m.b,{data:t.dataByTrack,options:{responsive:!0,maintainAspectRatio:!1,dragData:!0,dragDataRound:2,showTooltip:!0,title:{display:!1,text:this.props.title,fontSize:25},legend:{display:!0,position:"right"},scale:{ticks:{beginAtZero:!0,max:1}},onDragStart:function(t,a){console.log("dragging ",a),e.props.onColorChange(a._datasetIndex)},onDrag:function(e,t,a,n){e.target.style.cursor="grabbing"},onDragEnd:function(t,a,n,r){e.props.onDrag(a,n,r),t.target.style.cursor="default"},hover:{onHover:function(e){this.getElementAtEvent(e).length?e.target.style.cursor="grab":e.target.style.cursor="default"}}}}))),r.a.createElement("div",{className:"line"},r.a.createElement(m.a,{data:t.dataByAudioFeature,options:{responsive:!0,maintainAspectRatio:!1,dragData:!0,dragDataRound:2,title:{display:!1,text:this.props.title,fontSize:25},scales:{yAxes:[{ticks:{min:0,max:1,stepSize:.1}}]},legend:{display:this.props.displayLegend,position:"right"},onDragStart:function(t,a){console.log("dragging ",a),e.props.onColorChange(a._index)},onDrag:function(e,t,a,n){e.target.style.cursor="grabbing"},onDragEnd:function(t,a,n,r){e.props.onDrag(n,a,r),t.target.style.cursor="default"},hover:{onHover:function(e){this.getElementAtEvent(e).length?e.target.style.cursor="grab":e.target.style.cursor="default"}}}})))}}]),t}(n.Component);g.defaultProps={displayTitle:!0,displayLegend:!0,legendPosition:"right",colors:["rgba(245, 94, 29, 0.8)","rgba(0, 0, 0, 0.3)"]};var f=g,k=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).handleDrag=function(t,a,n){var r=e.state.rawIncomingData.spotifyAudioFeatures[a];e.setState((function(e){var a=Object.assign({},e.rawIncomingData.rawDataByTrack[t]);return a.audioFeatures[r]=n,a.audioFeatures.shouldChange=1,{selectedTrack:a}}))},e.handleColorChange=function(t){console.log("index in parent app",t),e.setState((function(e){Object.assign({},e.selectedTrackIndex);return{selectedTrackIndex:t}}))},e.handleReset=function(t){t.preventDefault(),console.log("Reset triggered"),e.setState({rawIncomingData:e.state.previousState})},e.state={},e}return Object(d.a)(t,e),Object(c.a)(t,[{key:"handleCommitSet",value:function(e){e.preventDefault();var t=window.location.search,a=new URLSearchParams(t),n={refresh_token:a.get("refresh_token"),mode:a.get("mode")};fetch("https://music-in-context-backend.herokuapp.com/commitplaylist",{mode:"cors",method:"POST",body:JSON.stringify({refresh_token:n.refresh_token,mode:n.mode}),headers:{"Content-Type":"application/json"}}).then(console.log("Sent to Spotify"))}},{key:"handleRequestNewTracks",value:function(e){var t=this;e.preventDefault();var a=window.location.search,n=new URLSearchParams(a),r={refresh_token:n.get("refresh_token"),mode:n.get("mode")};fetch("https://music-in-context-backend.herokuapp.com/changeset",{mode:"cors",method:"POST",body:JSON.stringify({previousTrackList:this.state.rawIncomingData.rawDataByTrack,previousTrackIDs:this.state.rawIncomingData.trackIDs,refresh_token:r.refresh_token,mode:r.mode}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){t.setState((function(t){var a=Object.assign({},t.rawIncomingData);return a.rawDataByTrack=e.newTracks,a.trackIDs=e.trackIDs,{rawIncomingData:a}}))})).then(console.log(this.state))}},{key:"componentDidMount",value:function(){var e=this,t=window.location.search,a=new URLSearchParams(t),n={refresh_token:a.get("refresh_token"),mode:a.get("mode"),form_data:a.get("form_data")};fetch("https://music-in-context-backend.herokuapp.com/setfromcluster",{mode:"cors",method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){e.setState({rawIncomingData:t,previousState:t,selectedTrackIndex:0})}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"App"},r.a.createElement(f,{rawIncomingData:this.state.rawIncomingData,title:"Audio Features",legendPosition:"bottom",onDrag:function(t,a,n){return e.handleDrag(t,a,n)},onRequestNewTracks:function(t){return e.handleRequestNewTracks(t)},onCommitSet:function(t){return e.handleCommitSet(t)},onReset:function(t){return e.handleReset(t)},onColorChange:function(t){return e.handleColorChange(t)},colors:["rgba(245, 94, 29, 1)","rgba(0, 0, 0, 0.1)"],selectedTrackIndex:this.state.selectedTrackIndex}))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(k,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},48:function(e,t,a){e.exports=a(169)},53:function(e,t,a){},54:function(e,t,a){}},[[48,1,2]]]);
//# sourceMappingURL=main.68fa95c1.chunk.js.map